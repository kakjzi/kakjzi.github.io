{"componentChunkName":"component---src-templates-post-jsx","path":"/cost2/","result":{"data":{"site":{"siteMetadata":{"title":"Shin, Jiwoo"}},"markdownRemark":{"id":"37b0c210-1408-5a2e-8ccd-d64ef6027b55","excerpt":"안녕하세요!👋🏻 지금까지 AWS의 EC2에 Attach되어 있는 IP 주소에 대해서는 과금하지 않았는데, 2024년 2월 1일부터 AWS Public IPv4 주소 사용이 시간당 0.005 USD 과금됩니다. 또한, 신규 AWS 프리티어 고객인 경우 매달 750시간의 Public IP 주소를 무료로 사용할 수 있습니다. AWS는 Public IP Insig…","html":"<p>안녕하세요!👋🏻</p>\n<p>지금까지 AWS의 EC2에 Attach되어 있는 IP 주소에 대해서는 과금하지 않았는데, <strong>2024년 2월 1일</strong>부터 AWS Public IPv4 주소 사용이 시간당 0.005 USD 과금됩니다.</p>\n<p>또한, 신규 AWS 프리티어 고객인 경우 매달 750시간의 Public IP 주소를 무료로 사용할 수 있습니다. AWS는 Public IP Insights라는 새로운 기능을 통해 고객이 자신의 Public IPv4 주소 사용 현황을 모니터링하고 최적화할 수 있도록 지원합니다. 이를 통해 불필요한 비용을 줄이고 IPv4 주소 사용을 효율적으로 관리할 수 있습니다.</p>\n<h2>Public IPv4 주소의 유형</h2>\n<ul>\n<li>EC2 Public IPv4</li>\n<li>Elastic IP</li>\n<li>\n<p>서비스 관리형 Public IPv4 : 관리형 서비스를 배포할 때 리소스에 할당하는 Amazon 소유의 Public IPv4 주소</p>\n<ul>\n<li><a href=\"https://docs.aws.amazon.com/vpc/latest/userguide/what-is-amazon-vpc.html#pricing\">https://docs.aws.amazon.com/vpc/latest/userguide/what-is-amazon-vpc.html#pricing</a></li>\n</ul>\n</li>\n<li>BYOIP : 사용자 소유의 Public IPv4 주소를 AWS로 가져온 경우 (이 경우만 무료)</li>\n</ul>\n<h2>청구서 정보</h2>\n<p><figure class='gatsby-resp-image-figure' style='margin-bottom: 16px;'>\n    <span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; '>\n      <a class='gatsby-resp-image-link' href='/static/c5d88a7c3c4db08026bf51ad73c1ffeb/5b5fb/publicIp_cost.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 15.294117647058824%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAkUlEQVR42l2OXQ6DIBCEOUlRBAUFBQXqb3r/U01X0pf68GV2MpPdZb2b4ZcVY8iQnUUtTaFRPQRpJbrCq27Bf/MTTpkePIwNYEo7xPeJhUjrhbx/kLYLIe1ozYiqMRBqgJ0iHXTkezr4Dxe65PdTTOqRPtwQ4l7wkeZ8UCFBtBYNLVFmwpyOord/cvcG6juf8QUVxlnjhRcBsAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='청구서 내역' title='' src='/static/c5d88a7c3c4db08026bf51ad73c1ffeb/ca1dc/publicIp_cost.png' srcset='/static/c5d88a7c3c4db08026bf51ad73c1ffeb/e7570/publicIp_cost.png 170w,\n/static/c5d88a7c3c4db08026bf51ad73c1ffeb/f46e7/publicIp_cost.png 340w,\n/static/c5d88a7c3c4db08026bf51ad73c1ffeb/ca1dc/publicIp_cost.png 680w,\n/static/c5d88a7c3c4db08026bf51ad73c1ffeb/02d09/publicIp_cost.png 1020w,\n/static/c5d88a7c3c4db08026bf51ad73c1ffeb/9d567/publicIp_cost.png 1360w,\n/static/c5d88a7c3c4db08026bf51ad73c1ffeb/5b5fb/publicIp_cost.png 2128w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span>\n    <figcaption class='gatsby-resp-image-figcaption'>청구서 내역</figcaption>\n  </figure></p>\n<ul>\n<li>PublicIPv4:IdleAddress: AWS 계정에서 유휴 상태 인 모든 퍼블릭 IPv4 주소의 사용량을 보여줍니다.</li>\n<li>PublicIPv4:InUseAddress: AWS 리소스에서 사용 중인 모든 퍼블릭 IPv4 주소의 사용량을 보여줍니다. 여기에는 EC2 퍼블릭 IPv4 주소, 탄력적 IP 주소 및 서비스 관리형 퍼블릭 IPv4 주소가 포함됩니다. BYOIP 주소 사용에 대한 비용이 없기 때문에 BYOIP는 포함되지 않습니다.</li>\n</ul>\n<p>실제로 비용청구되는 것을 해석해보면,</p>\n<p>'Idle' Public IPv4 주소의 경우, 시간당 $0.005의 비용이 부과됩니다. 총 58.092시간 동안 'Idle' 상태였으므로, 이에 대한 총 비용은 USD 0.29입니다.</p>\n<p>'In-use' Public IPv4 주소는 시간당 $0.005의 비용이 부과되며, 총 5.807시간 동안 사용되어 총 비용은 USD 0.03입니다.</p>\n<p>그리고 시간이 딱 떨어지지 않는 것으로 보아 Public IPv4 주소의 과금이 시간당이 아니라 분 단위로 이루어진다는 것을 알 수 있습니다.\n이는 AWS가 Public IPv4 주소 사용에 대해 더 세밀한 과금 체계를 적용하고 있음을 의미합니다.</p>\n<h2>Public IPv4 주소 비용 최적화 방안</h2>\n<p>AWS는 아래와 같이 비용 최적화 방안을 제시하고 있습니다.</p>\n<ol>\n<li>IPv6 사용</li>\n<li>Public IPv4 자동 활성화 옵션 비활성화</li>\n<li>EIC(EC2 Instance Connect)를 통한 리소스 원격 연결</li>\n</ol>\n<h3>1. IPv6 사용</h3>\n<p>AWS에서는 IPv6 주소에 대한 비용을 부과하지 않습니다.</p>\n<blockquote>\n<p>IPv6를 지원하는 서비스 항목</p>\n<p><a href=\"https://docs.aws.amazon.com/vpc/latest/userguide/aws-ipv6-support.html\">https://docs.aws.amazon.com/vpc/latest/userguide/aws-ipv6-support.html</a></p>\n</blockquote>\n<h3>2. Public IPv4 자동 활성화 옵션 비활성화</h3>\n<p>인스턴스를 생성하는 시점에 서브넷 또는 인스턴스에 자동 할당 옵션이 켜져 있을 경우, 리소스에 불필요한 Public IP 할당이 이루어질 수 있습니다.</p>\n<p><figure class='gatsby-resp-image-figure' style='margin-bottom: 16px;'>\n    <span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; '>\n      <a class='gatsby-resp-image-link' href='/static/3a2eae4d1bf4fd9232294d3920e50ec5/adfb5/subnet_ip.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 42.94117647058824%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAABbUlEQVR42n2R207CQBCG+8heeGEUUdoSRAzc6MMREWgEC7Klp93tifI7s0A9hNjky8x0Zv+ZnbXa9gta3RFunWe03BE6tgvHcSke4Np5gtvpo0P+TXeItv2Ih/s+XGeEVm8I+24Am85etnu4uLINli8EVsEWfhDAWwt8him2UYxtGEIqhaIskRcFCiIvSmRlgewUV4XJlVVpyLIM1ng8xtt0ivlsjsnkFQt/Bam1EZNSIk3ThqTxJeIkQRTHiOOD5QE4by2XH6Zgv98fqbHb7Qx5nhtb1/UvuE5TUxZNjo1YVEoFK9iGiKLIFHBhVVWNYEaCFfsk8s0hVucE6VbWgiaceR5mcw/e+xIRdVGUSNXB8rW58wFpyHRm7E9B9nmfVrjZQKxWEL4PsV4jEgFS2oemAzy1Uhqals3+CZ6e//0V5Ae0VETLDIQhJWKxgabkjrr99/E6zgvStczr8Ys20E6kRk4FxRkq4u8OT4JfAl+cDQ0RrhwAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='공용 IPv4 주소 자동 할당을 끄는 위치' title='' src='/static/3a2eae4d1bf4fd9232294d3920e50ec5/ca1dc/subnet_ip.png' srcset='/static/3a2eae4d1bf4fd9232294d3920e50ec5/e7570/subnet_ip.png 170w,\n/static/3a2eae4d1bf4fd9232294d3920e50ec5/f46e7/subnet_ip.png 340w,\n/static/3a2eae4d1bf4fd9232294d3920e50ec5/ca1dc/subnet_ip.png 680w,\n/static/3a2eae4d1bf4fd9232294d3920e50ec5/02d09/subnet_ip.png 1020w,\n/static/3a2eae4d1bf4fd9232294d3920e50ec5/9d567/subnet_ip.png 1360w,\n/static/3a2eae4d1bf4fd9232294d3920e50ec5/adfb5/subnet_ip.png 3422w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span>\n    <figcaption class='gatsby-resp-image-figcaption'>공용 IPv4 주소 자동 할당을 끄는 위치</figcaption>\n  </figure>\n따라서, 위 그림에 표시된 것처럼 기본 서브넷에서 공용 IPv4 주소 자동 할당을 비활성화하는 것이 좋습니다. 예를 들어 Amazon ECS 배포 또는 RDS 데이터베이스를 호스팅하는 서브넷에는 퍼블릭 IPv4 주소가 필요하지 않을 수\n있습니다.</p>\n<h3>3. EIC를 통한 리소스 원격 연결</h3>\n<p>기존에는 VPC 내의 리소스에 원격으로 액세스하려면 Bastion Host에 Elastic IP를 할당하는 방식을 이용하고 있습니다.</p>\n<p>이제는 <a href=\"https://aws.amazon.com/ko/blogs/compute/secure-connectivity-from-public-to-private-introducing-ec2-instance-connect-endpoint-june-13-2023/\">EIC</a>를 사용하여 IPv4에 대해서 비용을 절감하는 것을 권장드립니다.</p>\n<p>EIC를 사용하게 되면 이점은 아래와 같습니다</p>\n<ul>\n<li>Public IPv4 주소 비할당</li>\n<li>IGW나 NAT 게이트웨이없이 접근 가능</li>\n<li>에이전트 설치 불필요</li>\n<li>IAM 및 보안그룹을 통한 액세스 제어</li>\n<li>콘솔에서 연결 가능</li>\n<li>사용에 따른 추가 비용 없음</li>\n</ul>\n<h2>Public IP 에 대해 추적하고 편리하게 관리하기 위한 명령어</h2>\n<p>사실 AWS에서 제공하는 Amazon VPC IPAM 퍼블릭 IP Insights로 퍼블릭 IPv4 사용량 모니터링할 수 있지만 public IP에 대해 좀 더 쉽게(?) 관리할 수 있는 명령어들을 공유드립니다.</p>\n<p>명령어는 아래의 목적을 차례대로 갖고 있습니다.</p>\n<ol>\n<li>VPC 내에서 사용되지 않고 있는(즉, 어떤 인스턴스에도 연결되지 않은) Elastic IP 주소를 조회</li>\n<li>\n<p>네트워크 인터페이스의 정보를 조회하여 공용 IP 주소가 연결된 인터페이스를 필터링</p>\n<p>2.1. 서비스 관리형 퍼블릭 IPv4 또한 포함합니다.</p>\n</li>\n<li>AWS Global Accelerator와 연결된 퍼블릭 IPv4 주소 추적</li>\n<li>AWS Site-to-Site VPN 연결과 연결된 퍼블릭 IPv4 주소 추적</li>\n</ol>\n<h4>mac 환경</h4>\n<p>사전 준비 : <code class=\"language-text\">brew install jq</code> 또는 \"AWS CLI에서 직접적으로 특정 필드만 추출하는 기능을 제공하는 <code class=\"language-text\">--query</code> 옵션을 사용해도 무방합니다.\"</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># VPC 내에서 사용되지 않고 있는(즉, 어떤 인스턴스에도 연결되지 않은) Elastic IP 주소를 조회</span>\naws ec2 describe-addresses <span class=\"token parameter variable\">--region</span><span class=\"token operator\">=</span><span class=\"token punctuation\">[</span>리전정보<span class=\"token punctuation\">]</span> <span class=\"token parameter variable\">--filters</span> <span class=\"token string\">\"Name=domain,Values=vpc\"</span> <span class=\"token operator\">|</span> jq <span class=\"token string\">'.Addresses | map(select(.AssociationId == null)) | .[] | {PublicIp: .PublicIp, AllocationId: .AllocationId, Region: .NetworkBorderGroup, Status: \"미사용\", NetworkInterfaceId: .NetworkInterfaceId}'</span>\n\n\n<span class=\"token comment\"># 네트워크 인터페이스의 정보를 조회하여 공용 IP 주소가 연결된 인터페이스를 필터링</span>\naws ec2 describe-network-interfaces <span class=\"token parameter variable\">--region</span><span class=\"token operator\">=</span><span class=\"token punctuation\">[</span>리전정보<span class=\"token punctuation\">]</span> <span class=\"token operator\">|</span> jq <span class=\"token string\">'.NetworkInterfaces | map(select(.Association != null)) | .[] | {PublicIp: .Association.PublicIp, Region: .AvailabilityZone, Status: if .Status == \"in-use\" then \"사용\" else \"미사용\", AllocationId: .Association.AllocationId, NetworkInterfaceId: .NetworkInterfaceId}'</span>\n\n\n<span class=\"token comment\"># AWS Global Accelerator와 연결된 퍼블릭 IPv4 주소 추적</span>\naws globalaccelerator list-accelerators <span class=\"token parameter variable\">--region</span> us-west-2 <span class=\"token operator\">|</span> jq <span class=\"token string\">'.Accelerators[].IpSets[].IpAddresses[]'</span>\n\n\n<span class=\"token comment\"># AWS Site-to-Site VPN 연결과 연결된 퍼블릭 IPv4 주소 추적</span>\naws ec2 describe-vpn-connections <span class=\"token operator\">|</span> jq <span class=\"token string\">'.VpnConnections[].VgwTelemetry[].OutsideIpAddress'</span></code></pre></div>\n<br/>\n<blockquote>\n<p>참고사이트</p>\n<ol>\n<li><a href=\"https://aws.amazon.com/ko/blogs/korea/new-aws-public-ipv4-address-charge-public-ip-insights/\">Public IP</a></li>\n<li><a href=\"https://aws.amazon.com/ko/about-aws/whats-new/2024/02/aws-free-tier-750-hours-free-public-ipv4-addresses/\">Public IP 프리티어</a></li>\n<li><a href=\"https://aws.amazon.com/ko/blogs/networking-and-content-delivery/identify-and-optimize-public-ipv4-address-usage-on-aws/\">Public IP Optimizer</a></li>\n<li><a href=\"https://aws.amazon.com/ko/blogs/compute/secure-connectivity-from-public-to-private-introducing-ec2-instance-connect-endpoint-june-13-2023/\">EIC 모범 사례</a></li>\n</ol>\n</blockquote>","frontmatter":{"title":"[AWS] Public IP 과금 소식","date":"February 13, 2024","update":"February 15, 2024","tags":["AWS","Cost"],"series":"AWS 비용"},"fields":{"slug":"/cost2/","readingTime":{"minutes":7.58}}},"seriesList":{"edges":[{"node":{"id":"5ec3aee9-22d9-5a42-a65b-3697851690c9","fields":{"slug":"/cost1/"},"frontmatter":{"title":"[AWS] 비용 비교: Lambda vs. EC2"}}},{"node":{"id":"37b0c210-1408-5a2e-8ccd-d64ef6027b55","fields":{"slug":"/cost2/"},"frontmatter":{"title":"[AWS] Public IP 과금 소식"}}}]},"previous":{"fields":{"slug":"/cost1/"},"frontmatter":{"title":"[AWS] 비용 비교: Lambda vs. EC2"}},"next":null},"pageContext":{"id":"37b0c210-1408-5a2e-8ccd-d64ef6027b55","series":"AWS 비용","previousPostId":"5ec3aee9-22d9-5a42-a65b-3697851690c9","nextPostId":null}},"staticQueryHashes":[],"slicesMap":{}}